//this is .c file for eusart driver BY DEFAULT IT IS SET TO 2400 BAUD
/*
void interrupt(){
 if(PIR1.RCIF){
  received_data=RCREG;
 }
}   */

void eusart_init(){
  TXSTA.SYNC=CLEAR; //CLEAR = ASYNCHRONOUS EUSART, SET = SYMCHRONOUS EUSART
  TXSTA.BRGH=CLEAR; //SET= HIGH, CLEAR=LOW
  BAUDCTL.BRG16=CLEAR; //CLEAR= 8 BIT GENERATOR FOR BAUD RATE , SET=16 BIT GENERATOR FOR BAUD RATE

  SPBRG=25; //2400 BITS/SECOND, BAUD RATE=2400
  RCSTA.SPEN=SET; //ENABLE TX AND RX AS SERIAL PORT TERMINAL

  TXSTA.TXEN=SET; //ENABLES TRASMITION
}

void eusart_send(unsigned char *package){
//STABILSHING COMMUNICATION
   TXREG=DUMMY;
   while(~TXSTA.TRMT); //WAIT FOR TSR REGISTER FOR BE READY TO RECEIVE NEW DATA TO BE SEND
   while(~PIR1.TXIF); //WAIT FOR THE TXREG FOR BE READY TO RECEIVE NEW DATA TO BE HOLD
//STARTING DATA TRANSMISSION
  while(1){
   TXREG=*package;   //SENDING CHARACTER TO THE TRANSMITTER REGISTER
   package+=1;       //INCREMENTING THE POINTER IN 1st ADDRES FOR READING NEXT CHARACTER
   if(*package == END) break;
   while(~TXSTA.TRMT); //WAIT FOR TSR REGISTER FOR BE READY TO RECEIVE NEW DATA TO BE SEND
   while(~PIR1.TXIF); //WAIT FOR THE TXREG FOR BE READY TO RECEIVE NEW DATA TO BE HOLD
   }
}

void eusart_sendc(unsigned char c){
//STARTING DATA TRANSMISSION
   TXREG=c;   //SENDING CHARACTER TO THE TRANSMITTER REGISTER
   while(~TXSTA.TRMT); //WAIT FOR TSR REGISTER FOR BE READY TO RECEIVE NEW DATA TO BE SEND
   while(~PIR1.TXIF); //WAIT FOR THE TXREG FOR BE READY TO RECEIVE NEW DATA TO BE HOLD

}

void eusart_sendn(unsigned char number){

 i=0;
 numb[0]=0;numb[1]=0;numb[2]=0;
 //SPLITTING
 while(number>=100){
   numb[0]+=1;
   number-=100;
 }
  while(number>=10){
   numb[1]+=1;
   number-=10;
 }
 numb[2]=number;
 //WRITE DATA
 if(numb[0]==0) i++;
 if(numb[1]==0) i++;
 while(i<3){
 //STARTING DATA TRANSMISSION
   TXREG=((0x30|numb[i]));   //SENDING CHARACTER TO THE TRANSMITTER REGISTER
   while(~TXSTA.TRMT); //WAIT FOR TSR REGISTER FOR BE READY TO RECEIVE NEW DATA TO BE SEND
   while(~PIR1.TXIF); //WAIT FOR THE TXREG FOR BE READY TO RECEIVE NEW DATA TO BE HOLD
   i++;
 }
 }

void eusart_receiver(unsigned char choose){
  PIE1.RCIE=1; //ENABLES RECEPTION INTERRUPTION
  INTCON.PEIE=1; //ENABLES PERIPHERIAL INTERRUPT
  INTCON.GIE=1; //ENABLES GLOBAL INTERRUPTS
  RCSTA.CREN=choose; //RECEPTION ENABLE
}